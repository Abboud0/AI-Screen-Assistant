import{r as s,i as b,j as t,_ as C}from"./index-D5HwKqlX.js";function T(){const[l,d]=s.useState(""),[p,m]=s.useState(!1),[g,n]=s.useState(null),[c,i]=s.useState(""),[h,f]=s.useState(!1),[y,u]=s.useState(0),o=s.useMemo(()=>l?`data:image/png;base64,${l}`:"",[l]),x=s.useCallback(async()=>{n(null),m(!0),d(""),i(""),u(0);try{const e=await b("capture_primary_screen_png_b64");if(!e)throw new Error("Empty screenshot");d(e)}catch(e){n(e?.message??"Failed to capture screen")}finally{m(!1)}},[]);s.useEffect(()=>{const e=()=>void x();return window.addEventListener("glint-capture",e),()=>window.removeEventListener("glint-capture",e)},[x]);async function v(){if(o){n(null),i(""),f(!0),u(0);try{const{default:e}=await C(async()=>{const{default:r}=await import("./index-DeY5ceUu.js").then(j=>j.i);return{default:r}},[]),a=r=>`./${r}`,{data:E}=await e.recognize(o,"eng",{workerPath:a("tesseract/worker.min.js"),corePath:a("tesseract/tesseract-core.wasm.js"),langPath:a("tesseract"),logger:r=>{r.status==="recognizing text"&&typeof r.progress=="number"&&u(Math.round(r.progress*100))}});i((E.text||"").trim())}catch(e){n(e?.message??"OCR failed")}finally{f(!1)}}}function w(e){const a=(c||"").trim();if(!a){n("No text extracted yet.");return}try{sessionStorage.setItem("glint:lastText",a)}catch{}window.__GLINT_LAST_TEXT__=a,window.dispatchEvent(new CustomEvent("glint-nav",{detail:e})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("glint-text",{detail:{text:a}}))},50)}return t.jsxs("div",{className:"page",children:[t.jsx("h2",{className:"page-title",children:"Capture"}),t.jsxs("div",{className:"actions",children:[t.jsx("button",{onClick:x,disabled:p,children:p?"Capturing…":"Capture Now"}),t.jsx("button",{onClick:()=>{d(""),i(""),n(null)},children:"Clear"}),t.jsx("button",{onClick:v,disabled:!o||h,children:h?`Extracting… ${y}%`:"Extract Text"}),t.jsx("button",{onClick:()=>w("summarize"),disabled:!c.trim(),children:"Send to Summarize"}),t.jsx("button",{onClick:()=>w("explain"),disabled:!c.trim(),children:"Send to Explain"})]}),g&&t.jsx("div",{style:{color:"crimson"},children:g}),t.jsx("div",{className:"panel",children:o?t.jsx("img",{src:o,alt:"screenshot",style:{maxWidth:"100%",borderRadius:8,display:"block"}}):t.jsx("div",{style:{opacity:.7},children:"No screenshot yet."})}),t.jsxs("div",{className:"panel",children:[t.jsx("label",{className:"page-title",style:{fontSize:13},children:"Extracted Text"}),t.jsx("textarea",{rows:10,value:c,onChange:e=>i(e.target.value),placeholder:"Run Extract Text to populate…"})]})]})}export{T as default};
